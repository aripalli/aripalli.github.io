<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <title>Week 7 exercises</title>
      <script type="text/javascript" src="d3/d3.js"></script>
      <script type="text/javascript" src="d3/index.js"></script>
  	  <style type="text/css">
		
  	  	text, h1,h2,p {
  	  		font-family: Helvetica, Arial, sans-serif;
  	  	}
  	  	.K0 { fill: rgba(38, 70, 83, 1);}
		.K1 { fill: rgba(42, 157, 143, 1);}
		.K2 { fill: rgba(233, 196, 106, 1);}
		.K3 { fill: rgba(244, 162, 97, 1);}
		.K4 { fill: rgba(231, 111, 81, 1);}
		.K5 { fill: #4F84B9; }

		.Ci {
			transition: fill 1.5s ease
		}

	</style>
  </head>

<body>
	<div class=Visualize1>
		<div class="textContainer">
			<h2>Visualizing geodata</h2>
			<p>For this final exercise we will visualize your results from the K
-means exercise from week 5.</p>
			<p id="graph_title"></p>
			<button id="K2" class="kButton">K2</button>
			<button id="K3" class="kButton">K3</button>
			<button id="K4" class="kButton">K4</button>
			<button id="K5" class="kButton">K5</button>
			<button id="K6" class="kButton">K6</button>
		</div>			
		<div class="VizContainer1"></div>
	</div>

	<script type="text/javascript">
	w = 800;
	h = 600;
	var margin = {top: 50, right: 50, bottom: 50, left: 50},
    				width = w - margin.left - margin.right,
    				height = h - margin.top - margin.bottom;

	var svg = d3.select(".VizContainer1").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
	
	var mapGroup = svg.append("g");
	var circleGroup = svg.append("g");
	var circleGroup2 = svg.append("g");		    

	var projection = d3.geo.mercator()
						    .center([-122.433701, 37.767683])
						    .scale(200000)
						    .translate([width / 2, height / 2]);
    var path = d3.geo.path().projection(projection);



	createSFPDmap()


	d3.json("kmeansdatalabels.json", function(json){
		console.log(json)


		var circles = circleGroup.selectAll("circle")
						 .data(json.Coordinates)
						 .enter()
						 .append("circle")
						 .attr("cx", function(d) {
							   return projection([d[0], d[1]])[0];
						  })
						 .attr("cy", function(d) {
							   return projection([d[0], d[1]])[1];
						   })
						 .attr("r", 3)
						 .attr("class","Ci")
						 .style("opacity",0.75);

	


		d3.selectAll(".kButton").on("click", function(){
			var buttonID = d3.select(this).attr("id")
			changeLabels(circles,buttonID)
			drawMean(json.Mean,buttonID)
			console.log(buttonID)
		});

		changeLabels(circles,'K2')
		drawMean(json.Mean,'K2')

		function changeLabels(circles,kID) {
			circles
			   .data(json[kID+'labels'])
			   .attr("class", function(d){
			   		return 'K'+d.toString()
			   })
		}

		function drawMean(meanData,kID) {
		circleGroup2.selectAll("circle").remove()
		id = kID[1]-2;
		circleGroup2.selectAll("circle")
					.data(meanData[id])
					.enter()
					.append("circle")
					.attr("cx", function(d) {
					   return projection([d[0], d[1]])[0];
					})
					.attr("cy", function(d) {
					   return projection([d[0], d[1]])[1];
					})
					.attr("r", 15)
					.attr("opacity", 0.75)
					.attr("class","meanCircles")
		}
	});


    function createSFPDmap() {
		d3.json("sfpddistricts.geojson", function(json) {
	        mapGroup.selectAll("path")
	           .data(json.features)
	           .enter()
	           .append("path")
	           .attr("d", path)
	           .style("fill", "#E6E6E6")
	           .attr('stroke-width',0.5)
				   .attr('stroke',"#626262");
		});
	}
	</script>
</body>
</html>